# Claude Code Session Rules

## üîÑ Rule #1: Save Progress Regularly

**CRITICAL:** Always maintain session progress to prevent data loss on disconnect.

### When to Save Progress
1. **After completing major tasks** (e.g., version releases, major bug fixes)
2. **Before starting complex multi-step operations** (e.g., database migrations, major refactors)
3. **Every 30-60 minutes** during active work
4. **After any git commit** that represents significant progress
5. **When user requests it** explicitly
6. **Before performing risky operations** (database changes, config updates)

### What to Save
Update `/home/administrator/.claude_session_progress.md` with:
- Current version and status
- Completed tasks (with ‚úÖ checkmarks)
- Pending tasks (with ‚ùì or ‚è≥ markers)
- Modified files list
- Git commit history
- Any unresolved issues or questions
- Commands needed to resume
- Application state (service status, logs, etc.)
- Important context about the work

### Template for Progress File
```markdown
# Claude Code Session Progress
**Last Updated:** [TIMESTAMP]
**Session Date:** [DATE]
**Current Version:** [VERSION]

## Current Status: [STATUS]

## Completed Work
- [Task 1]
- [Task 2]

## Pending Work
- [Task 1]
- [Task 2]

## Modified Files
- file1.py - [description]
- file2.html - [description]

## Git Status
- Latest commit: [hash] - [message]
- Branch: [branch]
- Status: [clean/changes]

## Unresolved Issues
- Issue 1: [description]

## How to Resume
1. Command 1
2. Command 2
```

### Quick Save Command
```bash
# Quick status check to include in progress file
echo "=== Quick Status ===" && \
git log --oneline -3 && \
git status --short && \
systemctl status huduglue-gunicorn --no-pager | head -5
```

---

## üìã Rule #2: Use TodoWrite Tool

Always use the TodoWrite tool for:
- Complex multi-step tasks (3+ steps)
- Non-trivial tasks requiring planning
- User provides multiple tasks
- Tasks that require careful tracking

Update todos:
- Mark in_progress BEFORE starting work
- Mark completed IMMEDIATELY after finishing
- Add new todos as subtasks are discovered
- Keep only ONE todo in_progress at a time

---

## üîç Rule #3: Read Before Edit

ALWAYS read files before editing:
- Use Read tool to see current content
- Understand context before making changes
- Never guess at file structure or content
- For large files, read relevant sections

---

## üß™ Rule #4: Verify After Changes

After making changes:
1. Restart application if needed
2. Check logs for errors
3. Verify service status
4. Test functionality if possible
5. Update progress file

Commands to verify:
```bash
# Restart app
sudo systemctl restart huduglue-gunicorn

# Check status
sudo systemctl status huduglue-gunicorn --no-pager

# Check logs
tail -50 /var/log/itdocs/gunicorn-error.log

# Verify version
source venv/bin/activate && python manage.py shell -c "from config.version import get_version; print(get_version())"
```

---

## üîê Rule #5: Security First

- NEVER commit sensitive data (API keys, passwords, tokens)
- Always use environment variables for secrets
- Run security scans after package updates
- Check for CVEs before upgrading packages
- Validate user input
- Use parameterized queries

---

## üì¶ Rule #6: Git Commit Best Practices

- Commit frequently with clear messages
- Use conventional commit format when appropriate
- Always add Co-Authored-By for Claude assistance
- Push to GitHub after completing logical units of work
- Never force push to main/master
- Keep commits atomic (one logical change per commit)

Commit message template:
```
[Action] [What] - [Why if not obvious]

[Detailed description if needed]
[Bullet points for multiple changes]

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

---

## üéØ Rule #7: Understand Before Acting

When user reports an issue:
1. **Ask clarifying questions** if unclear
2. **Read relevant files** to understand current state
3. **Search logs** for error messages
4. **Test/verify** the issue if possible
5. **Plan the fix** before implementing
6. **Verify the fix** after implementing

Don't assume or guess - investigate first.

---

## üìä Rule #8: Progress Transparency

Keep user informed:
- Explain what you're doing
- Show progress on multi-step tasks
- Report results of operations
- Acknowledge errors and explain fixes
- Use clear, concise language

---

## üîß Rule #9: Prefer Safe Operations

- Read files rather than overwriting
- Use Edit tool for targeted changes
- Back up before destructive operations
- Test in dev/staging before production (if available)
- Use transactions for database operations
- Keep old code commented out temporarily when refactoring

---

## ‚ö° Rule #10: Optimize for Reliability

- Check if services need restart after config changes
- Verify environment variables are set
- Check file permissions after creating files
- Ensure virtual environment is activated
- Use absolute paths when possible
- Handle errors gracefully

---

## üìù Session Checklist

At start of session:
- [ ] Read progress file if it exists
- [ ] Check git status
- [ ] Verify application is running
- [ ] Review any pending issues

During session:
- [ ] Save progress after major tasks
- [ ] Use TodoWrite for complex work
- [ ] Commit regularly
- [ ] Verify changes work

At end of session:
- [ ] Save final progress
- [ ] Push all commits to GitHub
- [ ] Verify application is running
- [ ] Document any unresolved issues

---

## üö® Emergency Recovery

If session disconnects unexpectedly:

1. **Read progress file:**
   ```bash
   cat /home/administrator/.claude_session_progress.md
   ```

2. **Check git for uncommitted work:**
   ```bash
   git status
   git diff
   git stash list
   ```

3. **Check application state:**
   ```bash
   sudo systemctl status huduglue-gunicorn
   tail -100 /var/log/itdocs/gunicorn-error.log
   ```

4. **Resume from last known good state:**
   - Review progress file for context
   - Check todo list
   - Verify what was completed
   - Continue from next pending task

---

**Last Updated:** 2026-01-11
**Version:** 1.0

name: Reopen Issue on Comment

on:
  issue_comment:
    types: [created]

jobs:
  reopen-issue:
    runs-on: ubuntu-latest
    # Only run if the issue is closed
    if: github.event.issue.state == 'closed'

    permissions:
      issues: write

    steps:
      - name: Reopen Issue
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.issue.number;
            const commenter = context.payload.comment.user.login;
            const issue_author = context.payload.issue.user.login;

            // Log for debugging
            console.log(`Issue #${issue_number} is closed, new comment from ${commenter}`);
            console.log(`Issue author: ${issue_author}`);

            // Reopen the issue
            await github.rest.issues.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue_number,
              state: 'open'
            });

            // Add a label to indicate it was auto-reopened
            try {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue_number,
                labels: ['reopened']
              });
            } catch (error) {
              console.log('Label "reopened" does not exist, skipping label addition');
            }

            console.log(`âœ… Issue #${issue_number} has been reopened due to new comment`);

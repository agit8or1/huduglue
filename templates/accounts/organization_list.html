{% extends "base.html" %}

{% block title %}Organizations - HuduGlue{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-building"></i> Organizations</h1>
    <div class="btn-group">
        <a href="{% url 'accounts:organization_merge' %}" class="btn btn-warning">
            <i class="fas fa-code-branch"></i> Merge Organizations
        </a>
        <a href="{% url 'accounts:organization_create' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create Organization
        </a>
    </div>
</div>

<!-- Filter and Sort Controls -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-4">
                <label for="type_filter" class="form-label"><i class="fas fa-filter"></i> Filter by Type</label>
                <select name="type" id="type_filter" class="form-select" onchange="this.form.submit()">
                    <option value="">All Types</option>
                    {% for type_value, type_label in org_type_choices %}
                    <option value="{{ type_value }}" {% if request.GET.type == type_value %}selected{% endif %}>{{ type_label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="sort_by" class="form-label"><i class="fas fa-sort"></i> Sort By</label>
                <select name="sort" id="sort_by" class="form-select" onchange="this.form.submit()">
                    <option value="name" {% if request.GET.sort == 'name' or not request.GET.sort %}selected{% endif %}>Name (A-Z)</option>
                    <option value="-name" {% if request.GET.sort == '-name' %}selected{% endif %}>Name (Z-A)</option>
                    <option value="organization_type" {% if request.GET.sort == 'organization_type' %}selected{% endif %}>Type (A-Z)</option>
                    <option value="-organization_type" {% if request.GET.sort == '-organization_type' %}selected{% endif %}>Type (Z-A)</option>
                    <option value="created_at" {% if request.GET.sort == 'created_at' %}selected{% endif %}>Oldest First</option>
                    <option value="-created_at" {% if request.GET.sort == '-created_at' %}selected{% endif %}>Newest First</option>
                </select>
            </div>
            <div class="col-md-4 d-flex align-items-end">
                {% if request.GET.type or request.GET.sort and request.GET.sort != 'name' %}
                <a href="{% url 'accounts:organization_list' %}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Clear Filters
                </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>

{% if organizations %}
<div class="row">
    {% for org in organizations %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-building text-primary"></i>
                    {{ org.name }}
                    {% if not org.is_active %}
                    <span class="badge bg-secondary">Inactive</span>
                    {% endif %}
                </h5>
                {% if org.organization_type %}
                <div class="mb-2">
                    <span class="badge bg-info"><i class="fas fa-briefcase"></i> {{ org.organization_type }}</span>
                </div>
                {% endif %}
                {% if org.description %}
                <p class="card-text text-muted">{{ org.description|truncatewords:20 }}</p>
                {% endif %}
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="fas fa-tag"></i> {{ org.slug }}
                    </small>
                </div>
            </div>
            <div class="card-footer bg-transparent">
                <a href="{% url 'accounts:organization_detail' org.id %}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-eye"></i> View Details
                </a>
                <a href="{% url 'accounts:organization_edit' org.id %}" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-edit"></i> Edit
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card">
    <div class="card-body text-center py-5">
        <i class="fas fa-building fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">No organizations found</h5>
        <p class="text-muted">Create your first organization to get started.</p>
        <a href="{% url 'accounts:organization_create' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create Organization
        </a>
    </div>
</div>
{% endif %}
{% endblock %}
